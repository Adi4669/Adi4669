<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sign-up</title>
    <link rel="stylesheet" href="signup.css" />
  </head>
  <body>
    <div class="header">
      <div class="home">
        <a href="bd.html" class="home-btn" onclick="pageTransition(event)">
          The Red Thread
        </a>
        <span class="tooltip">Home</span>
      </div>
    </div>
    <h1
      style="
        text-align: center;
        font-family: Impact, Haettenschweiler, 'Arial Narrow Bold', sans-serif;
        font-size: 40px;
      ">
      The Red Thread <br />
      Sign-up
    </h1>
    <div id="container" class="login-container">
      <div id="form1" class="login-grid">
        <h1 style="text-align: center; font-weight: 800">
          Blood Bank Login: Portal/Application
        </h1>
        <p style="font-size: 24px; text-align: center">
          Enter your details to sign up:
        </p>
        <div class="input-wrapper">
          <input
            class="input"
            id="username"
            name="username"
            placeholder=""
            required />
          <label for="username">Username</label>
        </div>
        <div class="input-wrapper">
          <input
            class="input"
            id="password"
            type="password"
            name="password"
            placeholder=""
            required />
          <label for="password">Password</label>
        </div>
        <div class="input-wrapper">
          <input
            class="input"
            id="email"
            type="email"
            name="email"
            placeholder=""
            required />
          <label for="email">Email</label>
        </div>
        <div class="input-wrapper">
          <input
            class="input"
            id="phone"
            type="text"
            name="phone"
            placeholder=""
            required />
          <label for="phone">Phone Number</label>
        </div>
        <div class="input-wrapper">
          <input
            list="blood_groups"
            class="input"
            type="text"
            name="blood_group"
            id="blood_group"
            placeholder=""
            required />
          <label for="blood_group">Blood Group</label>
        </div>
        <datalist id="blood_groups">
          <option value="A+"></option>
          <option value="A-"></option>
          <option value="B+"></option>
          <option value="B-"></option>
          <option value="AB+"></option>
          <option value="AB-"></option>
          <option value="O+"></option>
          <option value="O-"></option>
        </datalist>

        <div class="input-wrapper">
          <input
            list="cities"
            name="city"
            id="city"
            class="input"
            type="text"
            placeholder=""
            required />
          <label for="city">City</label>
        </div>
        <datalist id="cities">
          <option value="Bengaluru"></option>
          <option value="Ahmedabad"></option>
          <option value="Chennai"></option>
          <option value="Delhi"></option>
          <option value="Kolkata"></option>
          <option value="Mumbai"></option>
          <option value="Hyderabad"></option>
        </datalist>
      </div>
      <a href="signed_in.html" onclick="nextPage(event)" class="create"
        >Create Account!</a
      >
    </div>

    <script>
      const API_BASE = "http://localhost:4000";

      async function nextPage(e) {
        e.preventDefault();
        const form = document.getElementById("form1");
        const name = form.querySelector('input[name="username"]').value.trim();
        const password = form
          .querySelector('input[name="password"]')
          .value.trim();
        const email = form.querySelector('input[name="email"]').value.trim();
        const phone = form.querySelector('input[name="phone"]').value.trim();
        const blood_group = form
          .querySelector('input[name="blood_group"]')
          .value.trim();
        const city = form.querySelector('input[name="city"]').value.trim();

        if (
          name === "" ||
          password === "" ||
          email === "" ||
          phone === "" ||
          blood_group === "" ||
          city === ""
        ) {
          alert("Error: Please fill all the fields!");
          return;
        }

        try {
          const res = await fetch(`${API_BASE}/api/auth/signup`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            credentials: "include",
            body: JSON.stringify({
              name,
              email,
              password,
              phone,
              bloodType: blood_group,
              location: city,
            }),
          });

          if (!res.ok) {
            const data = await res.json().catch(() => ({}));
            throw new Error(data.message || "Signup failed");
          }

          const data = await res.json();
          if (data.token) {
            localStorage.setItem("token", data.token);
          }

          window.location.href = "signed_in.html";
        } catch (err) {
          alert(err.message || "Signup failed");
        }
      }
    </script>
  </body>
</html>
